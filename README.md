# Лабораторная работа №4. Симуляция с пользовательсĸими ĸоллеĸциями и псевдослучайной моделью

**Студент**: Ларьков Андрей Александрович
**Группа**: М8О-103БВ-25

## Описание задачи
Реализовать модель библиотеки, состоящую из:
1.  **Хранилища книг** (списочная коллекция).
2.  **Индексов для быстрого поиска** (словарная коллекция).
3.  **Симуляции работы** (случайные события добавления, удаления, поиска).

## Выполнение требований

| Требование | Статус | Реализация                                                                          |
| :--- |:------:|:------------------------------------------------------------------------------------|
| **Пользовательская списочная коллекция** |   +    | Класс `BookCollection`. Реализован через **композицию** (внутри `self.books = []`). |
| **Пользовательская словарная коллекция** |   +    | Класс `IndexDict`. Поддерживает индексы по ISBN, Автору и Году.                     |
| **Магические методы** |   +    | Реализованы `__len__`, `__iter__`, `__getitem__`, `__repr__`.                       |
| **Поддержка срезов** |   +    | `BookCollection` поддерживает срезы .                                               |
| **Наследование** |   +    | Базовый класс `Book` $\to$ Производные `PaperBook`, `EBook`.                        |
| **Предметная логика в словаре** |   +    | `IndexDict` автоматически обновляет списки книг при добавлении/удалении.            |
| **Симуляция** |   +    | Функция `run_simulation` с поддержкой `seed` для воспроизводимости результатов.     |

## Архитектура классов

### 1. Модели данных
*   **`Book`**: Базовый класс (поля: *Title, Author, Year, Genre, ISBN*).
*   **`PaperBook(Book)`**: Производный класс, добавляет поле `weight`.
*   **`EBook(Book)`**: Производный класс, добавляет поля `size`, `format`.

### 2. Коллекции
*   **`BookCollection`**:
    *   Обертка над списком (Композиция).
    *   Отвечает за хранение и порядок добавления.
    *   Методы: `add_book`, `remove_book`.
    *   Доступ: по индексу и срезам (`__getitem__`).
*   **`IndexDict`**:
    *   Обертка над несколькими словарями.
    *   `isbn` (Unique): `str -> Book`
    *   `authors` (Non-unique): `str -> list[Book]`
    *   `years` (Non-unique): `int -> list[Book]`
    *   Обеспечивает поиск со сложностью $O(1)$.

### 3.Основной класс
*   **`Library`**: Главный класс, объединяющий `BookCollection` и `IndexDict`.
*   **Логика**: Гарантирует целостность данных. При вызове `library.add_book()` книга добавляется и в список, и во все индексы одновременно. При удалении — удаляется отовсюду.

## Запуск и Использование

### Запуск симуляции
Точка входа находится в $main.py$.

```bash
python3 -m src.main
```
## Пример лога работы
```code
ЗАПУСК СИМУЛЯЦИИ (Random Seed)

[Шаг 1] Событие: ADD
  -> Добавлена: Paper book: Eternal Forest, King, 1910, Sci-Fi, 924, 978-2-59752
  -> Всего книг: 1

[Шаг 2] Событие: SEARCH_YEAR
  -> В 2022 году ничего не выходило.

[Шаг 3] Событие: ADD
  -> Добавлена: Paper book: Hidden Code, King, 1984, Sci-Fi, 1213, 978-1-31230
  -> Всего книг: 2

[Шаг 4] Событие: SEARCH_MISSING
-> Система корректно вернула ошибку (Книги 000-0-00000-000 нет).

[Шаг 5] Событие: SEARCH_YEAR
  -> В 2015 году ничего не выходило.

[Шаг 6] Событие: REMOVE
-> Удалена: Eternal Forest

[Шаг 7] Событие: REMOVE
-> Удалена: Hidden Code

[Шаг 8] Событие: REMOVE
-> Ошибка: Нельзя удалить, библиотека пуста!

[Шаг 9] Событие: SEARCH_MISSING
-> Система корректно вернула ошибку (Книги 000-0-00000-000 нет).

[Шаг 10] Событие: ADD
  -> Добавлена: Paper book: Broken Soul, Gibson, 2007, Fiction, 1479, 978-5-68144
  -> Всего книг: 1

[Шаг 11] Событие: SEARCH_AUTHOR
-> Найдено 1 книг автора Gibson:
   Пример: Broken Soul

[Шаг 12] Событие: SEARCH_AUTHOR
-> Книг автора Orwell не найдено.

[Шаг 13] Событие: SEARCH_AUTHOR
-> Книг автора King не найдено.

[Шаг 14] Событие: ADD
  -> Добавлена: Ebook: Golden Star, Pushkin, 1943, History, 36.89, txt, 978-5-41633
  -> Всего книг: 2

[Шаг 15] Событие: REMOVE
-> Удалена: Broken Soul

[Шаг 16] Событие: SEARCH_AUTHOR
-> Найдено 1 книг автора Pushkin:
   Пример: Golden Star

[Шаг 17] Событие: SEARCH_MISSING
-> Система корректно вернула ошибку (Книги 000-0-00000-000 нет).

[Шаг 18] Событие: SEARCH_AUTHOR
-> Книг автора Gibson не найдено.

[Шаг 19] Событие: SEARCH_AUTHOR
-> Книг автора Orwell не найдено.

[Шаг 20] Событие: SEARCH_MISSING
-> Система корректно вернула ошибку (Книги 000-0-00000-000 нет).

СИМУЛЯЦИЯ ЗАВЕРШЕНА
Итого книг в библиотеке: 1
 ```
### Тестирование
Проект может быть протестирован с помощью модуля unittest. Тесты покрывают:

- Корректность добавления и удаления книг.
- Работу срезов (collection[0:5]).
- Поиск по авторам (возврат списка книг).
- Синхронизацию данных (удаление книги корректно чистит индексы).
- Обработку ошибок (KeyError при поиске несуществующего ISBN).
- Запуск тестов:

```bash
python3 -m unittest tests.test_library
```
